---
import type { CollectionEntry } from "astro:content";
import Card from "./Card.astro";
import Button from "./Button.astro";
import Pill from "./Pill.astro";
import { Image } from "astro:assets";
import colors from "../config/colors.json";

interface Props {
	post: CollectionEntry<"posts">;
	index?: number;
}

const { post, index = 0 } = Astro.props;
const { data } = post;
const isInitialLoad = index < 15;

const buttonLightColor =
	colors.light[Math.floor(Math.random() * colors.light.length)];
const buttonDarkColor =
	colors.dark[Math.floor(Math.random() * colors.dark.length)];
---

<style define:vars={{ softWhite: colors.softWhite }}>
	.post-title {
		color: black;
	}

	:global(.dark) .post-title {
		color: var(--softWhite);
	}

	.post-description {
		color: rgb(31 41 55);
	}

	:global(.dark) .post-description {
		color: var(--softWhite);
	}

	.post-image-container {
		border-color: black;
	}

	:global(.dark) .post-image-container {
		border-color: var(--softWhite);
	}

	.draft-badge {
		border-color: black;
	}

	:global(.dark) .draft-badge {
		color: var(--softWhite);
		border-color: var(--softWhite);
	}
</style>

<div transition:name={`post-${post.id}`}>
	<Card color="white">
		<div class="p-4 rounded-lg transition-colors dark:bg-black">
			<h3
				class="post-title poppins text-lg md:text-xl"
				transition:name={`title-${post.id}`}
			>
				{data.title}
			</h3>
			<div
				class="post-image-container rounded-lg border-3 my-4 h-56 overflow-hidden"
			>
				<Image
					src={data.imgUrl}
					alt={data.title}
					width={800}
					height={400}
					loading={isInitialLoad ? "eager" : "lazy"}
					decoding={isInitialLoad ? "sync" : "async"}
					class="rounded h-full w-full object-cover"
					transition:name={`image-${post.id}`}
				/>
			</div>
			<p class="post-description poppins">
				{data.description}
			</p>

			<div class="flex justify-end my-4">
				<div
					class="transition-colors hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg"
				>
					<Button
						href={`/${post.id}/`}
						color={buttonLightColor}
						darkColor={buttonDarkColor}
					>
						<span>Lire plus &rarr;</span>
					</Button>
				</div>
			</div>

			<div class="hidden sm:inline-block">
				<div class="flex justify-between items-center">
					<ul class="flex flex-wrap gap-4 mt-2">
						{
							data.tags.map((tag) => (
								<li>
									<a
										class="sanchez"
										href={`/tag/${tag.toLowerCase()}/`}
									>
										<Pill>{tag}</Pill>
									</a>
								</li>
							))
						}
					</ul>
					{
						data.draft && (
							<span class="draft-badge bg-green rounded-full border-2 py-1 px-4 text-sm card-shadow">
								Brouillon
							</span>
						)
					}
				</div>
			</div>
		</div>
	</Card>
</div>

<style>
	::view-transition-old(*),
	::view-transition-new(*) {
		animation-duration: 0.3s;
		animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
	}
</style>
