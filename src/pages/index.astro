---
import { getCollection } from "astro:content";
import Layout from "../layouts/Default.astro";
import FilterTags from "../components/components/FilterTags.vue";
import { tagHierarchy } from "../components/tagHierarchy";
import type { Post, PostsUpdateEvent } from "../utils/types/content";

// Récupération des posts initiaux pour le SSG
const allPosts = await getCollection("posts");
const initialPosts = allPosts
	.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
	.slice(0, 15);

const mainTags = Object.keys(tagHierarchy);
const totalPages = Math.ceil(allPosts.length / 15);
---

<Layout title="Posts" description="Web'Indé |" pageTitle="Web'Indé Posts">
	<main
		class="page-background bg-gray-2 dark:bg-gray-8 p-6"
		transition:name="main-content"
	>
		<!-- Zone de contenu dynamique -->
		<div id="dynamic-content">
			<!-- Composant Vue pour le filtrage -->
			<FilterTags
				client:visible
				mainTags={mainTags}
				tagHierarchy={tagHierarchy}
				initialPosts={initialPosts}
			/>
		</div>
	</main>
</Layout>

<script>
	import { useRandomColor } from "../composables/useRandomColor";

	const { getRandomColor } = useRandomColor();

	function updateBackgroundColor() {
		const isDark = document.documentElement.classList.contains("dark");
		const color = getRandomColor(isDark);
		const element = document.querySelector(".page-background");
		if (element) {
			element.style.backgroundColor = color;
		}
	}

	// Mettre à jour la couleur avant la transition
	document.addEventListener("astro:before-preparation", updateBackgroundColor);

	// Mettre à jour la couleur lors du changement de thème
	document.addEventListener("theme-changed", updateBackgroundColor);
</script>

<style>
	.page-background {
		transition: background-color 0.3s ease;
	}
</style>
